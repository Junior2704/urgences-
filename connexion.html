<!-- accueil.html -->
<!DOCTYPE html>
<html lang="fr">
<head>
  <link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1565c0">
  <meta charset="UTF-8">
  <title>Connexion</title>
  <link rel="icon" type="image/jpeg" href="logo.png">
  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
  import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  
  // --- Config Firebase ---
  const firebaseConfig = {
    apiKey: "AIzaSyBKp5-7NNy0Gyl0tNbDgD-BxucYdg8ArWo",
    authDomain: "urgences-a8ed4.firebaseapp.com",
    projectId: "urgences-a8ed4"
  };
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
window.allerAdmin = async function () {
    window.location.href = "connexionadmin.html";
  }
  // --- Fonction de connexion ---
  window.seConnecter = async function () {
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value;
    const message = document.getElementById("message");
    message.textContent = "";
    message.style.color = "red";

    try {
      // üîê Connexion utilisateur
      const userCredential = await signInWithEmailAndPassword(auth, email, password);
      const user = userCredential.user;

      // üîé V√©rifie dans Firestore si "doitChangerMDP" est vrai
      const ref = doc(db, "medecins", user.uid);
      const snap = await getDoc(ref);
if (snap.exists()) {
  const data = snap.data();

  // üî¥ V√©rifie si le compte est marqu√© pour suppression
  if (data.supprime === true) {
    window.location.href = "suppressioncompte.html";
    return;
  }

  // üîê V√©rifie si l'utilisateur doit changer son mot de passe
  if (data.doitChangerMDP === true) {
    window.location.href = "changer_mot_passe.html";
    return;
  }
}


    // ‚û°Ô∏è Sinon, redirige vers la page principale
// (mobile ‚Üí urgences_mobile, ordinateur ‚Üí urgences)
function isMobileDevice() {
  return /Android|iPhone|iPad|iPod|webOS|BlackBerry|Windows Phone|Mobile/i.test(navigator.userAgent)
      || (window.innerWidth < 850);
}

if (isMobileDevice()) {
  window.location.href = `fiche-mobile.html?uid=${user.uid}`;
} else {
  window.location.href = `shell.html`;
}


    } catch (error) {
  let errorMsg = "‚ùå Erreur de connexion. Veuillez r√©essayer.";

  switch (error.message) {
    case "Firebase: Error (auth/invalid-email).":
      errorMsg = "‚ö†Ô∏è Email invalide. V√©rifiez l'adresse saisie.";
      break;
    case "Firebase: Error (auth/user-disabled).":
      errorMsg = "üö´ Ce compte a √©t√© d√©sactiv√©. Contactez un administrateur.";
      break;
    case "Firebase: Error (auth/user-not-found).":
      errorMsg = "‚ùå Aucun compte trouv√© avec cet email.";
      break;
    case "Firebase: Error (auth/invalid-credential).":
      errorMsg = "üîë Mot de passe incorrect.";
      break;
    case "Firebase: Error (auth/missing-password).":
      errorMsg = "‚ö†Ô∏è Merci de saisir un mot de passe.";
      break;
    case "Firebase: Error (auth/too-many-requests).":
      errorMsg = "üö® Vous avez tent√© de vous connect√© trop de fois avec un mot de passe √©ronn√©. Merci de r√©essayer plus tard";
      break;
    case "Firebase: Error (auth/network-request-failed).":
      errorMsg = "üì∂ Probl√®me de connexion r√©seau. V√©rifiez votre connexion Internet.";
      break;
    default:
      errorMsg = "‚ùå Une erreur est survenue : " + error.message;
      break;
  }

  message.textContent = errorMsg;
}
  };
</script>

  <style>
    body {
      font-family: sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: #f4f4f4;
    }
    #loginBox {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
      text-align: center;
      margin-top: 60px;
      width: 300px;
    }
    input {
      padding: 10px;
      width: 100%;
      margin-bottom: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }

  /* üé® Effet au survol pour tous les boutons */
  button:hover {
    opacity: 0.85;
    transform: scale(1.05);
    transition: all 0.2s ease-in-out;
  }

  /* üß† Optionnel : effet au clic pour plus de r√©alisme */
  button:active {
    transform: scale(0.98);
  }

    #message {
      color: red;
      margin-top: 10px;
    }
    img {
      margin-top: 15px;
    }
   #shell-topbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 6px 20px 6px 16px; /* padding √† droite augment√© */
  background: #ffffff;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  width: 100%;
  position: fixed;
  top: 0;
  left: 0;
  height: 48px;
  font-family: Inter, Arial, sans-serif;
  z-index: 1000;
  box-sizing: border-box; /* pour inclure le padding dans la largeur */
}

#topbar-right {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  margin-right: 8px; /* un petit d√©calage suppl√©mentaire pour l'ascenseur */
}

#window-controls {
  display: flex;
  gap: 6px;
  margin-bottom: 4px; /* un peu plus d‚Äôespace entre les boutons et l‚Äôheure */
}

#datetime {
  font-weight: 500;
  font-size: 14px;
  color: #374151;
  line-height: 1.2; /* pour mieux s√©parer du haut */
}


#topbar-left {
  font-weight: bold;
  font-size: 20px;
}

#topbar-center {
  font-size: 16px;
  font-weight: 500;
}



#window-controls button {
  background: #e6f0fc;
  border: none;
  border-radius: 6px;
  width: 28px;
  height: 28px;
  font-weight: bold;
  cursor: pointer;
  transition: 0.2s;
}

#window-controls button:hover {
  background: #0078d4;
  color: white;
}

#window-controls button.close:hover {
  background: #e74c3c;
}



  </style>
</head>
<body>
<div id="shell-topbar">
  <!-- Titre √† gauche -->
  <div id="topbar-left">
    üöë GestUrg2
  </div>

  <!-- Texte central -->
  <div id="topbar-center">
    Connexion
  </div>

  <!-- Heure + boutons Electron √† droite -->
  <div id="topbar-right">
    <div id="window-controls" style="display:none;">
      <button onclick="electronMinimize()">‚Äî</button>
      <button onclick="electronMaximize()">‚òê</button>
      <button class="close" onclick="electronClose()">‚úï</button>
    </div>
    <span id="datetime"></span>
  </div>
</div>


<div id="loginBox" style="text-align:center; background:white; padding:25px; border-radius:12px; width:350px; margin:auto; box-shadow:0 0 10px rgba(0,0,0,0.1);">
  <h2>üîê Connexion</h2>

  <input type="email" id="email" placeholder="Email" style="width:90%;padding:10px;margin:8px 0;border:1px solid #ccc;border-radius:8px;">
  <input type="password" id="password" placeholder="Mot de passe" style="width:90%;padding:10px;margin:8px 0;border:1px solid #ccc;border-radius:8px;">

  <!-- ‚úÖ Bouton principal (utilisateur) -->
  <button onclick="seConnecter()" 
          style="background:#0078d4;color:white;border:none;padding:10px 20px;margin-top:10px;
                 border-radius:8px;cursor:pointer;width:90%;font-size:16px;">
    üë§ Se connecter
  </button>

  <!-- ‚öôÔ∏è Bouton secondaire (admin) -->
  <button onclick="allerAdmin()" 
          style="background:#ff9800;color:white;border:none;padding:10px 20px;margin-top:10px;
                 border-radius:8px;cursor:pointer;width:90%;font-size:16px;">
    üõ†Ô∏è Portail Admin
  </button>

  <div id="message" style="margin-top:10px;color:red;"></div>
  <img src="logo.png" alt="Logo" width="200" style="margin-top:15px;">
</div>

<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./service-worker.js')
    .then(() => console.log("Service Worker enregistr√© !"));
}
</script>

<script>
function updateDateTime() {
  const now = new Date();
  const options = { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' };
  const time = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
  document.getElementById('datetime').textContent = now.toLocaleDateString('fr-FR', options) + ' ' + time;
}

// Mise √† jour toutes les secondes
setInterval(updateDateTime, 1000);
updateDateTime();

// D√©tection Electron
function isElectron() {
  return !!window.electronAPI;
}

const controls = document.getElementById('window-controls');
if (controls && isElectron()) {
  controls.style.display = 'flex';
}

// Fonctions Electron
function electronMinimize() {
  if (!isElectron()) return;
  window.electronAPI.minimize();
}
function electronMaximize() {
  if (!isElectron()) return;
  window.electronAPI.maximize();
}
function electronClose() {
  if (!isElectron()) return;
  window.electronAPI.close();
}
</script>


</body>
</html>
