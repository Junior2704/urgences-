<!DOCTYPE html>
<html lang="fr">
<head>
<link rel="icon" type="image/jpeg" href="logo.png">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Affichage Patients - Urgences</title>

  <!-- Firebase compat -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <style>
    html, body {
      height: 100%;
      margin: 0;
      font-family: "Inter", "Segoe UI", sans-serif;
      background: linear-gradient(135deg, #f0f7ff, #e6eef8);
      color: #0b2240;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    /* --- HEADER --- */
    header {
      width: 100%;
      background: linear-gradient(90deg, #0b2240 0%, #004b8d 50%, #0078d4 100%);
      color: white;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 30px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    header img {
      height: 60px;
      width: auto;
      border-radius: 8px;
      object-fit: contain;
    }

    header h1 {
      flex: 1;
      text-align: center;
      font-size: 2rem;
      font-weight: 700;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: #ffffff;
      margin: 0;
    }

    #datetime {
      font-size: 1.1rem;
      color: #e0ecff;
    }

    /* === TITRES DE SECTIONS === */
.section-title {
  width: 100%;
  text-align: center;
  font-size: 1.8rem;
  color: #004b8d;
  text-transform: uppercase;
  margin-bottom: 10px;
  letter-spacing: 0.5px;
}

/* === SECTION : ACTIVIT√â GLOBALE === */
#dashboard-general {
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.general-row {
  display: flex;
  justify-content: center;
  align-items: stretch;
  flex-wrap: nowrap;
  gap: 18px;
  width: 100%;
  max-width: 1400px;
  margin-top: 10px;
}

/* === STYLE DES CARTES === */
.card {
  flex: 1;
  min-width: 0;
  background: white;
  border-radius: 16px;
  padding: 16px;
  text-align: center;
  box-shadow: 0 4px 14px rgba(0, 0, 0, 0.1);
  transition: transform 0.2s ease;
}

.card:hover {
  transform: scale(1.03);
}

.card h2 {
  font-size: 2.8rem;
  color: #0b2240;
  margin: 0;
}

.card p {
  font-size: 1.1rem;
  color: #64748b;
  margin-top: 5px;
  font-weight: 500;
}

/* Couleurs par type */
.card.total { border-top: 6px solid #0078d4; }
.card.attente { border-top: 6px solid #4caf50; }
.card.pec { border-top: 6px solid #ff9800; }
.card.couche { border-top: 6px solid #6f42c1; }
.card.critique { border-top: 6px solid #161414; }
.card.admin { border-top: 6px solid #41e14e; }

/* === SECTION : CIRCUITS PARTICULIERS === */
#dashboard-circuits {
  width: 100%;
  text-align: center;
}

.circuits-grid {
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  gap: 16px;
  width: 100%;
  max-width: 1200px;
  margin: 0 auto;
}

.circuit-card {
  background: linear-gradient(135deg, #f8fbff, #eef5ff);
  border-radius: 14px;
  padding: 14px;
  box-shadow: 0 3px 8px rgba(0,0,0,0.1);
  text-align: center;
}

.circuit-card h3 {
  font-size: 2.2rem;
  color: #0078d4;
  margin: 0;
}

.circuit-card p {
  font-size: 1.1rem;
  color: #1e3a8a;
  font-weight: 500;
  margin-top: 4px;
}

/* --- Couleurs personnalis√©es --- */
.circuit-card.general {
  border-top: 6px solid #1976D2; /* Bleu g√©n√©ral */
}

.circuit-card.pediatrie {
  border-top: 6px solid #7CB342; /* Vert doux */
}

.circuit-card.traumato {
  border-top: 6px solid #D84315; /* Orange fonc√© */
}

.circuit-card.ophtalmo {
  border-top: 6px solid #6A1B9A; /* Violet */
}

.circuit-card.gyn {
  border-top: 6px solid #C2185B; /* Rose fonc√© */
}

.circuit-card.psy {
  border-top: 6px solid #00897B; /* Bleu-vert apaisant */
}


/* --- T√©l√© grand √©cran --- */
@media (min-width: 1600px) {
  .card h2 { font-size: 3.2rem; }
  .circuit-card h3 { font-size: 2.6rem; }
}


    /* --- ANIMATION INFO PATIENTS --- */
  .info-animation {
  margin: 50px auto 0 auto; /* üîπ centre horizontalement */
  width: 85%;              /* üîπ largeur fluide mais contenue */
  max-width: 900px;        /* üîπ limite maximale */
  text-align: center;
  background: rgba(255,255,255,0.95);
  border-radius: 20px;
  box-shadow: 0 4px 14px rgba(0,0,0,0.1);
  padding: 40px 20px 60px;
  position: relative;
  min-height: 280px;
  overflow: hidden;
  z-index: 10;
}
    .info-title {
      font-size: 1.6rem;
      font-weight: 700;
      color: #004b8d;
      margin-bottom: 25px;
    }

    .step-anim {
      position: absolute;
      left: 50%;
      top: 90px;
      transform: translateX(-50%) translateY(30px);
      opacity: 0;
      width: 100%;
      transition: all 1s ease;
    }

    .step-anim.active {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    .step-anim .icon {
      font-size: 3rem;
      animation: pop 0.6s ease forwards;
    }

    @keyframes pop {
      0% { transform: scale(0.6); opacity: 0; }
      80% { transform: scale(1.15); opacity: 1; }
      100% { transform: scale(1); }
    }

    .step-anim .title {
      font-size: 1.3rem;
      font-weight: 600;
      margin-bottom: 6px;
      color: #0b2240;
    }

    .step-anim .text {
      font-size: 1rem;
      color: #364152;
      max-width: 700px;
      margin: 0 auto;
    }

    .note {
      margin-top: 220px;
      font-size: 1rem;
      color: #1f3b70;
      font-weight: 500;
      position: relative;
      z-index: 20;
    }

    footer {
      width: 100%;
      text-align: center;
      font-size: 0.9rem;
      color: #556;
      padding-bottom: 10px;
    }
	
		#bubble-container {
  position: fixed;
  top: 20px;
  right: 20px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  z-index: 9999;
  align-items: flex-end;
}

.bubble {
  max-width: 300px;
  padding: 10px 15px;
  border-radius: 8px;
  color: white;
  font-family: sans-serif;
  box-shadow: 0 2px 5px rgba(0,0,0,0.2);
  animation: fadeout 0.5s ease-in-out 1.5s forwards;
  word-wrap: break-word;
  text-align: left;
}

.administratif {
  background-color: #2196F3; /* bleu */
}

.alerte {
  background-color: #f44336; /* rouge */
}

@keyframes fadeout {
  to {
    opacity: 0;
    transform: translateX(-20px);
  }
}

.step-anim .icon {
  font-size: 48px;       /* taille des emoji */
  display: flex;
  align-items: center;
  justify-content: center;
  height: 70px;
  width: 70px;
  margin: 0 auto 10px;
}
.step-logo {
  height: 80px;          /* taille id√©ale */
  width: 80px;           /* carr√© */
  object-fit: contain;   /* emp√™che les d√©formations */
  display: block;
  margin: 0 auto;
}

  </style>
</head>
<body>
  <header>
    <img src="logo.png" alt="Logo h√¥pital">
    <h1>Service des Urgences</h1>
    <div id="datetime"></div>
  </header>

  <main>
   <!-- === ACTIVIT√â DU SERVICE === -->
<section id="dashboard-general">
  <h2 class="section-title">üìä Activit√© du service</h2>
  <div class="general-row">
    <div class="card total"><h2 id="total">--</h2><p>Total patients</p></div>
    <div class="card attente"><h2 id="attente">--</h2><p>En salle d'attente</p></div>
    <div class="card pec"><h2 id="pec">--</h2><p>En zone de soins</p></div>
    <div class="card critique"><h2 id="critique">--</h2><p>Urgences vitales</p></div>

    <div class="card couche"><h2 id="couche">--</h2><p>Urgences relatives</p></div>
    <div class="card admin"><h2 id="admin">--</h2><p>Administratif</p></div>
  </div>
</section>

<!-- === CIRCUITS PARTICULIERS === -->
<section id="dashboard-circuits">
  <h2 class="section-title">üß≠ Circuits</h2>
  <div class="circuits-grid">
        <div class="circuit-card general"><h3 id="circuit-general">--</h3><p>ü©∫ G√©n√©ral</p></div>
    <div class="circuit-card pediatrie"><h3 id="circuit-pediatrie">--</h3><p>üë∂ P√©diatrie</p></div>
    <div class="circuit-card traumato"><h3 id="circuit-traumato">--</h3><p>ü¶¥ Traumatologie</p></div>
    <div class="circuit-card ophtalmo"><h3 id="circuit-ophtalmo">--</h3><p>üëÄ Ophtalmologie</p></div>
    <div class="circuit-card gyn"><h3 id="circuit-gyn">--</h3><p>ü§∞ Gyn√©cologie</p></div>
    <div class="circuit-card psy"><h3 id="circuit-psy">--</h3><p>üß† Psychiatrie</p></div>
  </div>
</section>



    <!-- ANIMATION √âTAPES -->
    <div class="info-animation">
      <div class="info-title">Les √©tapes de votre prise en charge</div>

      <div id="step1" class="step-anim active">
        <div class="icon">üìù</div>
        <div class="title">Accueil administratif</div>
        <div class="text">Votre arriv√©e est enregistr√©e. Nous v√©rifions vos informations pour assurer votre suivi m√©dical et administratif.</div>
      </div>

      <div id="step2" class="step-anim">
        <div class="icon">üë©‚Äç‚öïÔ∏è</div>
        <div class="title">Triage infirmier</div>
        <div class="text">Un(e) infirmier(√®re) √©value votre √©tat afin de d√©terminer la priorit√© de votre prise en charge et vous oriente sur le bon circuit de soin(s).</div>
      </div>
<div id="step3" class="step-anim">
        <div class="icon">ü©∫</div>
        <div class="title">Auscultation</div>
        <div class="text">Un m√©decin, un interne ou un externe vous ausculte afin de d√©terminer la suite de votre prise en charge.
		Le m√©decin peut aussi rentrer en contact avec vos m√©decins habituels.</div>
      </div>
      <div id="step4" class="step-anim">
        <div class="icon">üî¨</div>
        <div class="title">Examens compl√©mentaires</div>
        <div class="text">Des examens (analyse, imagerie, etc.) peuvent √™tre n√©cessaires pour √©tablir un diagnostic pr√©cis.</div>
      </div>

      <div id="step5" class="step-anim">
        <div class="icon">üíä</div>
        <div class="title">Prise en charge m√©dicale</div>
        <div class="text">Le m√©decin urgentiste assure votre traitement et coordonne les soins n√©cessaires.</div>
      </div>

      <div id="step6" class="step-anim">
        <div class="icon">üè•</div>
        <div class="title">Observation ou hospitalisation</div>
        <div class="text">Selon votre √©tat, le m√©decin peut d√©cider de vous garder aux Urgences en observation.</div>
      </div>

      <div id="step7" class="step-anim">
        <div class="icon">üö™</div>
        <div class="title">Retour √† domicile (ou hospitalisation dans un service adapt√©)</div>
        <div class="text">Des consignes et un compte rendu sont donn√©s avant votre d√©part, pour un suivi optimal.</div>
      </div>
	  <div id="step8" class="step-anim">
        <div class="icon">‚ö†Ô∏è</div>
        <div class="title">Attention</div>
        <div class="text">Pour une prise en charge optimale, pensez √† nous communiquer tous vos ant√©c√©dents m√©dicaux ainsi que vos traitements.
		Si vous avez un m√©decin traitant, pensez √† nous donner ses coordonn√©es.
   </div>
      </div>
<div id="step9" class="step-anim">
        <div class="icon">
    <img src="logo.png" alt="Logo h√¥pital" class="step-logo">
  </div>
        <div class="title">Les Urgences s'engagent !</div>
        <div class="text"> Le service des Urgences s'incrit dans une d√©marche de qualit√© de la prise en charge.
		N'h√©sitez-pas √† nous √©crire pour faire une suggestion ou signaler une anomalie √† urgences.hopj@gmail.com
      </div>
	  </div>
      <div class="note">
        ‚ö†Ô∏è La rapidit√© du traitement d√©pend de la gravit√© m√©dicale.  
        Merci de votre compr√©hension et de votre patience.
      </div>
	  
    </div>
  </main>

  <script>
    // --- CONFIG FIREBASE ---
    const firebaseConfig = {
    apiKey: "AIzaSyBKp5-7NNy0Gyl0tNbDgD-BxucYdg8ArWo",
    authDomain: "urgences-a8ed4.firebaseapp.com",
    projectId: "urgences-a8ed4"
  };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // --- HORLOGE ---
    function updateClock() {
      const now = new Date();
      const optsDate = { weekday: "long", year: "numeric", month: "long", day: "numeric" };
      const dateStr = now.toLocaleDateString("fr-FR", optsDate);
      const timeStr = now.toLocaleTimeString("fr-FR", { hour: "2-digit", minute: "2-digit" });
      document.getElementById("datetime").textContent = `${dateStr} ‚Äì ${timeStr}`;
    }
    updateClock();
    setInterval(updateClock, 1000);

    // --- ANIMATION CHIFFRES ---
    function animateUpdate(el, newVal) {
      if (!el) return;
      if (el.textContent != newVal) {
        el.textContent = newVal;
        el.classList.add("pulse");
        setTimeout(() => el.classList.remove("pulse"), 250);
      }
    }

    // --- FIRESTORE : COMPTES PATIENTS ---
// --- FIRESTORE : COMPTES PATIENTS ---
async function updateCounts() {
  try {
    const snapshot = await db.collection("patients")
      .where("hospitalisationActive", "==", true)
      .get();

    const counts = { total: 0, attente: 0, couche: 0, critique: 0, admin: 0 };

    snapshot.forEach(doc => {
      const data = doc.data() || {};
      counts.total++;

      // üîπ Position
      const pos = (data.position || "").toLowerCase();

      // üîπ R√©cup√©ration de la gravit√© depuis l‚Äôhospitalisation en cours
      let gravite = "";
      if (Array.isArray(data.hospitalisations)) {
        const index = data.hospitalisationIndex ?? (data.hospitalisations.length - 1);
        const hosp = data.hospitalisations[index] || {};
        gravite = (hosp.gravite || "").toLowerCase();
      }

      // Comptages
      if (
        pos.includes("attente") ||
        pos.includes("sortie") ||
        pos.includes("nv-couche")
      
      ) {
        counts.attente++;
      }
      
      if (gravite.includes("admin")) counts.admin++;
  if (
        gravite.includes("p0") ||
        gravite.includes("p1") ||
        gravite.includes("p2") 
 
      ) {
        counts.couche++;
      }

      // ‚úÖ D√©tection √©tendue des urgences vitales
      if (
        gravite.includes("vital") ||
        gravite.includes("urgences_vitales") ||
        gravite.includes("urgence vitale") ||
        gravite.includes("p3") 
      ) {
        counts.critique++;
      }
    });

    const pec = Math.max(counts.total - counts.attente, 0);

    // üîπ Mise √† jour visuelle
    animateUpdate(document.getElementById("total"), counts.total);
    animateUpdate(document.getElementById("attente"), counts.attente);
    animateUpdate(document.getElementById("pec"), pec);
    animateUpdate(document.getElementById("couche"), counts.couche);
    animateUpdate(document.getElementById("critique"), counts.critique);
    animateUpdate(document.getElementById("admin"), counts.admin);


// --- Comptage des circuits particuliers ---
// --- Comptage des circuits particuliers ---
const circuits = { general: 0, pediatrie: 0, traumato: 0, ophtalmo: 0, gyn: 0, psy: 0 };

snapshot.forEach(doc => {
  const data = doc.data();
  const index = data.hospitalisationIndex ?? 0;
  const hosp = data.hospitalisations?.[index] || {};
  const circuit = (hosp.circuit || "").toLowerCase();

  if (circuit.includes("p√©d") || circuit.includes("ped")) circuits.pediatrie++;
  else if (circuit.includes("trauma")) circuits.traumato++;
  else if (circuit.includes("ophtalmo")) circuits.ophtalmo++;
  else if (circuit.includes("gyn")) circuits.gyn++;
  else if (circuit.includes("psy")) circuits.psy++;
  else circuits.general++; // ‚úîÔ∏è tous les autres vont dans "g√©n√©ral"
});

// --- Affichage circuits particuliers ---
animateUpdate(document.getElementById("circuit-general"), circuits.general);
animateUpdate(document.getElementById("circuit-pediatrie"), circuits.pediatrie);
animateUpdate(document.getElementById("circuit-traumato"), circuits.traumato);
animateUpdate(document.getElementById("circuit-ophtalmo"), circuits.ophtalmo);
animateUpdate(document.getElementById("circuit-gyn"), circuits.gyn);
animateUpdate(document.getElementById("circuit-psy"), circuits.psy);


  } catch (err) {
    console.error("Erreur Firestore:", err);
  }
}

    updateCounts();
    setInterval(updateCounts, 100);

    // --- ANIMATION DES √âTAPES ---
    const steps = document.querySelectorAll(".step-anim");
    let current = 0;
    function showStep(i) {
      steps.forEach((s, idx) => s.classList.toggle("active", idx === i));
    }
    setInterval(() => {
      current = (current + 1) % steps.length;
      showStep(current);
    }, 1000 );
	 function goFullScreen() {
    const doc = document.documentElement;
    if (doc.requestFullscreen) doc.requestFullscreen();
    else if (doc.webkitRequestFullscreen) doc.webkitRequestFullscreen();
    else if (doc.msRequestFullscreen) doc.msRequestFullscreen();
    window.removeEventListener('click', goFullScreen);
  }
// Conteneur global pour les bulles
let notificationContainer = document.getElementById('notification-container');
if (!notificationContainer) {
  notificationContainer = document.createElement('div');
  notificationContainer.id = 'notification-container';
  notificationContainer.style.position = 'fixed';
  notificationContainer.style.top = '12px';
  notificationContainer.style.right = '12px'; // EN HAUT √Ä DROITE
  notificationContainer.style.display = 'flex';
  notificationContainer.style.flexDirection = 'column';
  notificationContainer.style.gap = '8px'; // espace vertical entre bulles
  notificationContainer.style.zIndex = 9999;
  document.body.appendChild(notificationContainer);
}

// Fonction pour afficher une bulle
function afficherBulle(msg, type = 'info') {
  const el = document.createElement('div');
  el.textContent = msg;
  el.style.padding = '10px 14px';
  el.style.borderRadius = '8px';
  el.style.boxShadow = '0 2px 6px rgba(0,0,0,0.2)';
  el.style.fontSize = '14px';
  el.style.fontWeight = '500';
  el.style.opacity = '0';
  el.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
  el.style.transform = 'translateY(-10px)';

  // --- Code couleur selon type ---
  switch (type) {
    case 'success':
      el.style.background = '#e6ffed'; // vert clair
      el.style.color = '#064e22';      // texte vert fonc√©
      break;
    case 'error':
      el.style.background = '#ffdede'; // rouge clair
      el.style.color = '#a00';         // texte rouge fonc√©
      break;
    case 'warning':
      el.style.background = '#fff4e5'; // orange clair
      el.style.color = '#663c00';      // texte orange fonc√©
      break;
    default: // info ou autre
      el.style.background = '#333';    // gris fonc√©
      el.style.color = '#fff';         // texte blanc
      break;
  }

  notificationContainer.appendChild(el);

  // Animation d'entr√©e
  requestAnimationFrame(() => {
    el.style.opacity = '1';
    el.style.transform = 'translateY(0)';
  });

  // Suppression automatique apr√®s 3 secondes
  setTimeout(() => {
    el.style.opacity = '0';
    el.style.transform = 'translateY(-10px)';
    el.addEventListener('transitionend', () => el.remove());
  }, 3000);
}

  // Demande le plein √©cran au premier clic ou tap
  window.addEventListener('click', goFullScreen);
  window.addEventListener('touchstart', goFullScreen);

  console.log("üí° Cliquez une fois dans la page pour passer en plein √©cran.");
  afficherBulle("üí° Cliquez une fois dans la page pour passer en plein √©cran", "default");




</script>
  </body>
</html>
