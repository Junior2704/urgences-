<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Nettoyage PDFs</title>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <h2>Nettoyage des PDF expirés...</h2>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBKp5-7NNy0Gyl0tNbDgD-BxucYdg8ArWo",
      authDomain: "urgences-a8ed4.firebaseapp.com",
      projectId: "urgences-a8ed4"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    async function nettoyerPDFs() {
      const now = new Date();
      const uneSemaine = 7 * 24 * 60 * 60 * 1000;

      const snapshot = await db.collection("liens_pdfs").get();
      let count = 0;
      for (const doc of snapshot.docs) {
        const data = doc.data();
        if (data.dateCreation?.toDate) {
          const age = now - data.dateCreation.toDate();
          if (age > uneSemaine) {
            await doc.ref.delete();
            count++;
          }
        }
      }
      document.body.innerHTML += `<p>✅ ${count} lien(s) supprimé(s).</p>`;
    }

    nettoyerPDFs();
  </script>
</body>
</html>
