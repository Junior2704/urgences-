<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Nettoyage PDF</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
    import { getFirestore, collection, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "...",
      authDomain: "...",
      projectId: "urgences-a8ed4",
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function cleanupPDFs() {
      const now = Date.now();
      const sevenDays = 7 * 24 * 60 * 60 * 1000;

      const snapshot = await getDocs(collection(db, "pdfs"));
      let deleted = 0;

      for (const docSnap of snapshot.docs) {
        const data = docSnap.data();
        if (data.createdAt && now - data.createdAt > sevenDays) {
          await deleteDoc(doc(db, "pdfs", docSnap.id));
          deleted++;
        }
      }

      document.body.innerHTML = `<h2>ðŸ§¹ ${deleted} PDF supprimÃ©s (anciens de plus de 7 jours)</h2>`;
    }

    cleanupPDFs();
  </script>
</head>
<body style="font-family: sans-serif; text-align: center; margin-top: 40px;">
  <h2>Nettoyage en cours...</h2>
</body>
</html>
