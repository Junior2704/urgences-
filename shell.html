<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<link rel="icon" type="image/jpeg" href="logo.png">
<title>ðŸš‘ GestUrg2</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:Inter,Arial,sans-serif;background:#f0f4f8;height:100vh;display:flex;flex-direction:column}

/* ===== BARRE TOP FIXE ===== */
#shell-topbar{
  position:fixed;top:0;left:0;right:0;height:64px;
  background:#ffffff;display:flex;flex-direction:column;
  padding:6px 14px;z-index:10000;box-shadow:0 4px 16px rgba(0,0,0,.12)
}

#actions{
  display:flex;gap:10px;align-items:center
}

.action-btn{
  background:#e6f0fc;
  border:none;
  border-radius:12px;
  padding:8px 14px;
  font-weight:600;
  cursor:pointer;
  transition:.2s;
}
.action-btn:hover{background:#0078d4;color:white}

/* ===== ONGLET TYPE CHROME ===== */
#tabs{
  display:flex;gap:4px;overflow-x:auto;margin-top:6px
}
.tab{
  background:#e5e7eb;border-radius:10px 10px 0 0;
  padding:6px 12px;cursor:pointer;white-space:nowrap;
  display:flex;align-items:center;gap:6px;font-size:14px
}
.tab.active{background:#0078d4;color:#fff}
.tab span.close{cursor:pointer;font-weight:bold}

/* ===== CONTENU ===== */
#content{
  flex:1;margin-top:64px;display:flex;flex-direction:column
}
iframe{
  border:none;width:100%;height:100%;background:white;display:none
}
#home{
  display:flex;align-items:center;justify-content:center;
  height:100%;color:#6b7280;font-size:20px
}
#shell-topbar {
  display: flex;
  flex-direction: column;
  padding: 6px 14px;
}

#topbar-left, #topbar-right {
  display: flex;
  align-items: center;
}

#topbar-left {
  position: absolute;
  left: 14px;
  top: 10px;
  font-weight: bold;
  font-size: 20px;
}

#topbar-right {
  position: absolute;
  right: 14px;
  top: 10px;
  font-weight: 500;
  font-size: 14px;
  color: #374151;
}
#shell-topbar {
  position: fixed;
  top: 0; left: 0; right: 0;
  height: 64px;
  background: #ffffff;
  padding: 6px 14px;
  box-shadow: 0 4px 16px rgba(0,0,0,.12);
  display: flex;
  flex-direction: column;
  z-index: 10000;
}

#topbar-main {
  display: flex;
  align-items: center;
  justify-content: space-between; /* Titre Ã  gauche, actions au centre, date Ã  droite */
  gap: 10px;
}

#app-title {
  font-weight: bold;
  font-size: 20px;
}

#actions {
  display: flex;
  gap: 10px;
  flex-wrap: wrap; /* pour les Ã©crans plus petits */
  justify-content: center; /* centre les boutons */
}

#datetime {
  font-weight: 500;
  font-size: 14px;
  color: #374151;
}

</style>
</head>
<body>

<div id="shell-topbar">
  <div id="topbar-main">
    <span id="app-title">ðŸš‘ GestUrg2</span>

    <div id="actions">
      <button class="action-btn" onclick="openTab('Urgences','urgences.html')">ðŸš‘ Urgences</button>
      <button class="action-btn" onclick="openTab('Patients','patients.html')">ðŸ‘¥ Patients</button>
      <button class="action-btn" onclick="openTab('Tableau','regulation.html')">ðŸ“Š Tableau</button>
      <button class="action-btn" onclick="openTab('Imagerie','gestionnaireradiologie.html')">ðŸ©» Imagerie</button>
      <button class="action-btn" onclick="openTab('Outils','MesOutils.html')">ðŸ§° Outils</button>
      <button class="action-btn" onclick="openTab('Compte','viewacount.html')">ðŸ‘¤Mon compte</button>
      <button class ="action-btn" id="btnLogout">ðŸ”“ DÃ©connexion</button>
    </div>

    <span id="datetime"></span>
  </div>

  <div id="tabs"></div>
</div>



<div id="content">
  <div id="home">SÃ©lectionnez un module pour commencer</div>
</div>

<script>
let tabs = [];
let activeTab = null;

function openTab(title, url){
  let existing = tabs.find(t=>t.url===url);
  if(existing){setActive(existing.id);return;}

  const id = Date.now();
  tabs.push({id,title,url});

  const tab = document.createElement('div');
  tab.className='tab';tab.dataset.id=id;
  tab.innerHTML=`${title} <span class="close">âœ•</span>`;
  tab.onclick=()=>setActive(id);
  tab.querySelector('.close').onclick=(e)=>{e.stopPropagation();closeTab(id)};
  document.getElementById('tabs').appendChild(tab);

  const iframe=document.createElement('iframe');
  iframe.src=url;iframe.dataset.id=id;
  document.getElementById('content').appendChild(iframe);

  document.getElementById('home').style.display='none';
  setActive(id);
}

function setActive(id){
  activeTab=id;
  document.querySelectorAll('.tab').forEach(t=>t.classList.toggle('active',t.dataset.id==id));
  document.querySelectorAll('iframe').forEach(f=>f.style.display=f.dataset.id==id?'block':'none');
}
document.getElementById("btnLogout").addEventListener("click", () => {
    signOut(auth)
      .then(() => {
        window.location.href = "index.html";
      })
      .catch((error) => {
        afficherBulle("Erreur de dÃ©connexion" ,"error");
      });
  });
function closeTab(id){
  tabs=tabs.filter(t=>t.id!==id);
  document.querySelector(`.tab[data-id='${id}']`)?.remove();
  document.querySelector(`iframe[data-id='${id}']`)?.remove();

  if(!tabs.length){
    document.getElementById('home').style.display='flex';
    activeTab=null;return;
  }
  if(activeTab===id) setActive(tabs[tabs.length-1].id);
}

/* === API pour ouvrir depuis urgences.html === */
window.openInShell = function(title, url){
  openTab(title, url);
};
window.addEventListener("message", (event) => {
  if (!event.data) return;

  if (event.data.type === "OPEN_TAB") {
    openTab(event.data.title, event.data.url);
  }
});
function updateDateTime() {
  const now = new Date();
  const options = { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' };
  const time = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
  document.getElementById('datetime').textContent = now.toLocaleDateString('fr-FR', options) + ' ' + time;
}

// Mise Ã  jour toutes les secondes
setInterval(updateDateTime, 1000);
updateDateTime();

</script>
<script type="module">
  
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
  import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBKp5-7NNy0Gyl0tNbDgD-BxucYdg8ArWo",
    authDomain: "urgences-a8ed4.firebaseapp.com",
    projectId: "urgences-a8ed4"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // DÃ©connexion
  document.getElementById("btnLogout").addEventListener("click", () => {
    signOut(auth)
      .then(() => {
        window.location.href = "index.html";
      })
      .catch((error) => {
        afficherBulle("Erreur de dÃ©connexion" ,"error");
      });
  });

  // Auth state + rÃ©cupÃ©ration du mÃ©decin
 onAuthStateChanged(auth, async (user) => {
  if (!user) {
    console.log("Aucun utilisateur connectÃ©");
   window.location.href = "index.html";
    return;
  }

  // Parcours des iframes ouvertes
  document.querySelectorAll('iframe').forEach(iframe => {
    iframe.contentWindow.postMessage({
      type: "USER_CONNECTED",
      user: {
        uid: user.uid,
        email: user.email,
        displayName: user.displayName
      }
    }, "*");
  });
});
 
</script>
</body>
</html>
