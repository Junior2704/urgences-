<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<link rel="icon" type="image/jpeg" href="logo.png">
<title>üöë GestUrg2</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:Inter,Arial,sans-serif;background:#f0f4f8;height:100vh;display:flex;flex-direction:column}

/* ===== BARRE TOP FIXE ===== */
#shell-topbar{
  position:fixed;top:0;left:0;right:0;height:64px;
  background:#ffffff;display:flex;flex-direction:column;
  padding:6px 14px;z-index:10000;box-shadow:0 4px 16px rgba(0,0,0,.12)
}

#actions{
  display:flex;gap:10px;align-items:center
}

.action-btn{
  background:#e6f0fc;
  border:none;
  border-radius:12px;
  padding:8px 14px;
  font-weight:600;
  cursor:pointer;
  transition:.2s;
}
.action-btn:hover{background:#0078d4;color:white}

/* ===== ONGLET TYPE CHROME ===== */
#tabs{
  display:flex;gap:4px;overflow-x:auto;margin-top:6px
}
.tab{
  background:#e5e7eb;border-radius:10px 10px 0 0;
  padding:6px 12px;cursor:pointer;white-space:nowrap;
  display:flex;align-items:center;gap:6px;font-size:14px
}
.tab.active{background:#0078d4;color:#fff}
.tab span.close{cursor:pointer;font-weight:bold}

/* ===== CONTENU ===== */
#content{
  flex:1;margin-top:64px;display:flex;flex-direction:column
}
iframe{
  border:none;width:100%;height:100%;background:white;display:none
}
#home{
  display:flex;align-items:center;justify-content:center;
  height:100%;color:#6b7280;font-size:20px
}
#shell-topbar {
  display: flex;
  flex-direction: column;
  padding: 6px 14px;
}

#topbar-left, #topbar-right {
  display: flex;
  align-items: center;
}

#topbar-left {
  position: absolute;
  left: 14px;
  top: 10px;
  font-weight: bold;
  font-size: 20px;
}

#topbar-right {
  position: absolute;
  right: 14px;
  top: 10px;
  font-weight: 500;
  font-size: 14px;
  color: #374151;
}
#shell-topbar {
  position: fixed;
  top: 0; left: 0; right: 0;
  height: 64px;
  background: #ffffff;
  padding: 6px 14px;
  box-shadow: 0 4px 16px rgba(0,0,0,.12);
  display: flex;
  flex-direction: column;
  z-index: 10000;
}

#topbar-main {
  display: flex;
  align-items: center;
  justify-content: space-between; /* Titre √† gauche, actions au centre, date √† droite */
  gap: 10px;
}

#app-title {
  font-weight: bold;
  font-size: 20px;
}

#actions {
  display: flex;
  gap: 10px;
  flex-wrap: wrap; /* pour les √©crans plus petits */
  justify-content: center; /* centre les boutons */
}

#datetime {
  font-weight: 500;
  font-size: 14px;
  color: #374151;
}
/* ===== DROPDOWN OUTILS ===== */
.dropdown {
  position: relative;
}

.dropdown-content {
  position: absolute;
  top: 100%;           /* coll√© au bouton */
  left: 0;
  margin-top: 2px;     /* optionnel */
  background: white;
  min-width: 320px;
  border-radius: 12px;
  box-shadow: 0 10px 25px rgba(0,0,0,.15);
  padding: 6px;
  z-index: 10001;
  display: none;
}

.dropdown:hover .dropdown-content {
  display: block;
}

.dropdown-content.open {
  display: block;
}



.dropdown-item {
  position: relative;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 10px;
  border-radius: 8px;
  font-size: 14px;
  cursor: default;
}

.dropdown-item:hover {
  background: #e6f0fc;
}

.dropdown-item span {
  background: #0078d4;
  color: white;
  padding: 4px 10px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 13px;
}

.dropdown-item span:hover {
  background: #005fa3;
}

/* ===== TOOLTIP DESCRIPTION ===== */
.dropdown-item::after {
  content: attr(data-desc);
  position: absolute;
  left: 105%;
  top: 50%;
  transform: translateY(-50%);
  background: #111827;
  color: white;
  padding: 8px 10px;
  border-radius: 8px;
  width: 260px;
  font-size: 13px;
  opacity: 0;
  pointer-events: none;
  transition: opacity .3s;
}

.dropdown-item:hover::after {
  opacity: 1;
}
.dropdown-content {
  display: none;
}

/* OUVERTURE AU SURVOL */
.dropdown:hover .dropdown-content {
  display: block;
}

/* OUVERTURE PERSISTANTE AU CLIC */
.dropdown-content.open {
  display: block;
}

</style>
</head>
<body>

<div id="shell-topbar">
  <div id="topbar-main">
    <span id="app-title">üöë GestUrg2</span>

    <div id="actions">
      <button class="action-btn" onclick="openTab('Urgences','urgences.html')">üöë Urgences</button>
      <button class="action-btn" onclick="openTab('Tableau','regulation.html')">üìä Tableau</button>
<div class="dropdown" id="dropdownOutils">
  <button class="action-btn" id="btnOutils">üß∞ Outils ‚ñæ</button>

  <div class="dropdown-content" id="menuOutils">

    <div class="dropdown-item" data-desc="Acc√©der aux dossiers et comptes rendus des patients.">
      üë• Patients
      <span onclick="openTab('Patients','patients.html')">Ouvrir</span>
    </div>

    <div class="dropdown-item" data-desc="Cr√©er les ordonnances m√©dicales des patients. Pr√©-remplissage possible via la fiche patient.">
      üìÑ Ordonnancier
      <span onclick="openTab('Ordonnancier','Ordonnancier.html')">Ouvrir</span>
    </div>

    <div class="dropdown-item" data-desc="√âtablir les factures patients. Pr√©-remplissage possible via la fiche patient.">
      üí≥ Facturation
      <span onclick="openTab('Facturation','Facturation.html')">Ouvrir</span>
    </div>

    <div class="dropdown-item" data-desc="R√©diger rapidement des certificats m√©dicaux. Pr√©-remplissage possible via la fiche patient.">
      üßæ Certificats m√©dicaux
      <span onclick="openTab('Certificats','Certificatmedical.html')">Ouvrir</span>
    </div>

    <div class="dropdown-item" data-desc="Imprimer des fiches conseils de sortie adapt√©es √† la pathologie.">
      üìã Fiches conseils
      <span onclick="openTab('Fiches conseils','fichesconseil.html')">Ouvrir</span>
    </div>

    <div class="dropdown-item" data-desc="Visualiser les examens, r√©diger les comptes rendus et g√©rer l‚Äôimagerie.">
      ü©ª Gestionnaire imagerie
      <span onclick="openTab('Imagerie','gestionnaireradiologie.html')">Ouvrir</span>
    </div>

    <div class="dropdown-item" data-desc="√âcrire un email √† un patient. Pr√©-remplissage possible via la fiche patient.">
      ‚úâÔ∏è Mail To
      <span onclick="openTab('Mail','mailto.html')">Ouvrir</span>
    </div>

    <div class="dropdown-item" data-desc="Cr√©er un acc√®s patient pour un PDF et/ou l‚Äôenvoyer par email. Pr√©-remplissage possible via la fiche patient.">
      üìé Acc√®s PDF patient
      <span onclick="openTab('PDF Patient','uploadpdf.html')">Ouvrir</span>
    </div>

    <div class="dropdown-item" data-desc="Voir les donn√©es de votre compte (non modifiables).">
      üë§ Mon compte
      <span onclick="openTab('Mon compte','viewacount.html')">Ouvrir</span>
    </div>

  </div>
</div>

      <button class="action-btn" onclick="openTab('Compte','viewacount.html')">üë§Mon compte</button>
      <button class ="action-btn" id="btnLogout">üîì D√©connexion</button>
    </div>

    <span id="datetime"></span>
  </div>

  <div id="tabs"></div>
</div>



<div id="content">
  <div id="home">S√©lectionnez un module pour commencer</div>
</div>

<script>
let tabs = [];
let activeTab = null;

function openTab(title, url){
  let existing = tabs.find(t=>t.url===url);
  if(existing){setActive(existing.id);return;}

  const id = Date.now();
  tabs.push({id,title,url});

  const tab = document.createElement('div');
  tab.className='tab';tab.dataset.id=id;
  tab.innerHTML=`${title} <span class="close">‚úï</span>`;
  tab.onclick=()=>setActive(id);
  tab.querySelector('.close').onclick=(e)=>{e.stopPropagation();closeTab(id)};
  document.getElementById('tabs').appendChild(tab);

  const iframe=document.createElement('iframe');
  iframe.src=url;iframe.dataset.id=id;
  document.getElementById('content').appendChild(iframe);

  document.getElementById('home').style.display='none';
  setActive(id);
}

function setActive(id){
  activeTab=id;
  document.querySelectorAll('.tab').forEach(t=>t.classList.toggle('active',t.dataset.id==id));
  document.querySelectorAll('iframe').forEach(f=>f.style.display=f.dataset.id==id?'block':'none');
}
document.getElementById("btnLogout").addEventListener("click", () => {
    signOut(auth)
      .then(() => {
        window.location.href = "index.html";
      })
      .catch((error) => {
        afficherBulle("Erreur de d√©connexion" ,"error");
      });
  });
function closeTab(id){
  tabs=tabs.filter(t=>t.id!==id);
  document.querySelector(`.tab[data-id='${id}']`)?.remove();
  document.querySelector(`iframe[data-id='${id}']`)?.remove();

  if(!tabs.length){
    document.getElementById('home').style.display='flex';
    activeTab=null;return;
  }
  if(activeTab===id) setActive(tabs[tabs.length-1].id);
}

/* === API pour ouvrir depuis urgences.html === */
window.openInShell = function(title, url){
  openTab(title, url);
};
window.addEventListener("message", (event) => {
  if (!event.data) return;

  if (event.data.type === "OPEN_TAB") {
    openTab(event.data.title, event.data.url);
  }
});
function updateDateTime() {
  const now = new Date();
  const options = { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' };
  const time = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
  document.getElementById('datetime').textContent = now.toLocaleDateString('fr-FR', options) + ' ' + time;
}
const btnOutils = document.getElementById("btnOutils");
const menuOutils = document.getElementById("menuOutils");
const dropdownOutils = document.getElementById("dropdownOutils");

// Clic = ouverture persistante
btnOutils.addEventListener("click", (e) => {
  e.stopPropagation();
  menuOutils.classList.toggle("open");
});

// Emp√™cher fermeture quand on clique dans le menu
menuOutils.addEventListener("click", (e) => {
  e.stopPropagation();
});

// Fermer seulement si clic ailleurs
document.addEventListener("click", () => {
  menuOutils.classList.remove("open");
});


// Mise √† jour toutes les secondes
setInterval(updateDateTime, 1000);
updateDateTime();

</script>
<script type="module">
  
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
  import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBKp5-7NNy0Gyl0tNbDgD-BxucYdg8ArWo",
    authDomain: "urgences-a8ed4.firebaseapp.com",
    projectId: "urgences-a8ed4"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // D√©connexion
  document.getElementById("btnLogout").addEventListener("click", () => {
    signOut(auth)
      .then(() => {
        window.location.href = "index.html";
      })
      .catch((error) => {
        afficherBulle("Erreur de d√©connexion" ,"error");
      });
  });

  // Auth state + r√©cup√©ration du m√©decin
 onAuthStateChanged(auth, async (user) => {
  if (!user) {
    console.log("Aucun utilisateur connect√©");
   window.location.href = "index.html";
    return;
  }

  // Parcours des iframes ouvertes
  document.querySelectorAll('iframe').forEach(iframe => {
    iframe.contentWindow.postMessage({
      type: "USER_CONNECTED",
      user: {
        uid: user.uid,
        email: user.email,
        displayName: user.displayName
      }
    }, "*");
  });
});
 
</script>
</body>
</html>
