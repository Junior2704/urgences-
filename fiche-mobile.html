<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Urgences ‚Äî Mobile</title>
<link rel="icon" type="image/jpeg" href="logo.png">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
  :root{
    --brand:#0078d4;
    --bg:#f0f4f8;
    --card:#ffffff;
    --muted:#6b7280;
    --radius:12px;
}

/* Global */
html,body{
    height:100%;
    margin:0;
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
    background:var(--bg);
    color:#111;
}

/* Main */
#main {
    flex: 1;
    padding: 20px;
}

.container {
    max-width: 500px;
    margin: 40px auto;
    background: white;
    padding: 28px;
    border-radius: var(--radius);
    box-shadow: var(--shadow);
}

#list-container {
    background: white;
    padding: 20px;
    border-radius: 12px;
    max-width: 600px;
}

/* Top controls & Inputs */
.top-controls {
    display: flex;
    gap: 10px;
    align-items: center;
    width: 100%;
    margin-top: 20px;
}

input {
    flex: 1;
    padding: 14px 16px;
    border: 2px solid var(--blue-soft);
    background: white;
    border-radius: var(--radius);
    font-size: 15px;
    outline: none;
    transition: 0.2s;
}

input:focus {
    border-color: var(--blue-main);
    box-shadow: 0 0 0 3px rgba(30, 111, 255, 0.2);
}

/* Buttons */
.btn {
    padding: 14px 18px;
    border: none;
    border-radius: var(--radius);
    cursor: pointer;
    color: white;
    font-weight: 600;
    transition: 0.2s;
    font-size: 15px;
    flex-shrink: 0;
}

.btn-add {
    background: linear-gradient(145deg, #4b8bff, #0054ff);
    box-shadow:
        0 4px 10px rgba(0, 90, 255, 0.25),
        inset 0 1px 1px rgba(255,255,255,0.25);
}

.btn-add:hover {
    transform: translateY(-3px) scale(1.03);
    box-shadow:
        0 10px 22px rgba(0, 90, 255, 0.40),
        inset 0 1px 2px rgba(255,255,255,0.3);
}

.btn-add:active {
    transform: scale(0.97);
}

.btn-shop {
    background: linear-gradient(145deg, #ffa93a, #ff7a00);
    box-shadow:
        0 4px 10px rgba(255, 140, 0, 0.30),
        inset 0 1px 1px rgba(255,255,255,0.25);
}

.btn-shop:hover {
    transform: translateY(-3px) scale(1.03);
    box-shadow:
        0 10px 22px rgba(255, 140, 0, 0.45),
        inset 0 1px 2px rgba(255,255,255,0.3);
}

.btn-shop:active {
    transform: scale(0.97);
}

.btn-green {
    background: linear-gradient(135deg, #28a745, #32d067);
    box-shadow: 0 3px 10px rgba(40, 167, 69, 0.35);
}

.btn-green:hover {
    background: #1f8a39;
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(40,167,69,0.35);
}

.btn-grey {
    background: linear-gradient(135deg, #9aa0b3, #7d8394);
    color: white !important;
}

.btn-grey:hover {
    background: #6d6d6d;
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(130,130,130,0.35);
}

/* List Items */
#items li,
#list-items li {
    list-style: none;
    background: white;
    padding: 14px 18px;
    border-radius: 14px;
    margin: 12px 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 15px;
    font-weight: 500;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
    border: 1px solid #eef1f7;
    transition: 0.2s;
}

#items li:hover,
#list-items li:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 18px rgba(0, 0, 0, 0.10);
}

/* Delete Button */
.deleteBtn {
    border: none;
    background: linear-gradient(135deg, #ff5c5c, #d90429);
    color: white;
    padding: 8px 12px;
    border-radius: 10px;
    cursor: pointer;
    font-size: 16px;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: 0.2s;
}

.deleteBtn::before {
    content: "üóëÔ∏è";
    font-size: 15px;
}

.deleteBtn:hover {
    transform: scale(1.1);
    box-shadow: 0 3px 10px rgba(255, 0, 0, 0.25);
}

/* Modals */
.modal-bg {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    backdrop-filter: blur(5px);
    background: rgba(0, 0, 0, 0.45);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 5000;
}

.modal {
    width: 92%;
    max-width: 480px;
    background: linear-gradient(135deg, #ffffff, #f3f6ff);
    padding: 28px;
    border-radius: 22px;
    box-shadow: 0 15px 40px rgba(0,0,0,0.22);
    animation: pop 0.25s ease-out;
}

.modal-header h2 {
    color: #2c3e50;
    font-weight: 700;
}

.modal-item {
    background: #e8edff;
    border-left: 6px solid #4a6cf7;
    padding: 14px;
    border-radius: 14px;
    margin-bottom: 12px;
}

/* Home Section */
#homeSection {
    display: flex;
    align-items: center;
    gap: 20px;
    padding: 20px;
    background: #f9f9f9;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

#logo {
    width: 80px;
    height: auto;
    animation: fadeIn 1.5s ease-in-out;
}

/* Sidebar */
.menu-btn {
    background: transparent;
    border: none;
    font-size: 26px;
    cursor: pointer;
    padding: 6px 10px;
    color: var(--brand);
}

.sidebar {
    border-top-right-radius: 20px;
    border-bottom-right-radius: 20px; 
    position: fixed;
    top: 0;
    left: -260px;
    width: 260px;
    height: 100%;
    background: white;
    box-shadow: 4px 0 18px rgba(0,0,0,0.15);
    z-index: 3000;
    transition: 0.3s ease;
    display: flex;
    flex-direction: column;
}

.sidebar.open {
    left: 0;
}

.sidebar-header {
    font-size: 20px;
    font-weight: 700;
    padding: 20px;
    background: var(--brand);
    color: white;
}

.sidebar-item {
    padding: 16px 20px;
    font-size: 16px;
    border-bottom: 1px solid #eee;
    cursor: pointer;
}

.sidebar-item:hover {
    background: #f0f7ff;
}

.sidebar-item.logout {
    margin-top: auto;
    background: #ffeaea;
    color: #b30000;
    font-weight: 700;
}

.sidebar-item.logout:hover {
    background: #ffd2d2;
}

.sidebar-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.35);
    z-index: 2500;
    display: none;
}

.sidebar-overlay.show {
    display: block;
}
.action-btn {
    border: none;
    background: #eef4ff;
    border-radius: 10px;
    padding: 6px 10px;
    font-size: 18px;
    cursor: pointer;
    transition: 0.2s;
}

.action-btn:hover {
    background: #d7e9ff;
    transform: scale(1.1);
}

/* Keyframes */
@keyframes spinAround {
    from { transform: rotate(0deg); }
    to   { transform: rotate(360deg); }
}

/* ====== RESPONSIVE MOBILE ====== */
@media (max-width: 600px) {
    html {
        font-size: 14px;
    }
    #main { padding: 12px; }
    .container, #list-container {
        margin: 20px 10px;
        padding: 20px;
        max-width: 95%;
    }
    input {
        padding: 12px 14px;
        font-size: 14px;
    }
    .btn, .btn-add, .btn-shop, .btn-green, .btn-grey {
        padding: 12px 16px;
        font-size: 14px;
    }
    #items li, #list-items li {
        padding: 12px 14px;
        font-size: 14px;
    }
    #homeSection {
        flex-direction: column;
        gap: 12px;
        padding: 14px;
    }
    #logo { width: 60px; }
    .top-controls { flex-direction: column; gap: 12px; }
    .sidebar { width: 220px; }
    .modal { width: 90%; padding: 20px; }
    .sidebar-header { font-size: 18px; padding: 16px; }
    .sidebar-item { padding: 14px 16px; font-size: 14px; }
}
.modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.45);
    backdrop-filter: blur(5px);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 6000; /* AU-DESSUS de tout */
}
/* ===============================
   CARTES PATIENTS
================================ */
.patient-card{
  display:flex;
  align-items:center;
  gap:14px;
  padding:14px 16px;
  background:#fff;
  border-radius:16px;
  margin-bottom:12px;
  box-shadow:0 6px 18px rgba(0,0,0,0.08);
  cursor:pointer;
  transition:0.2s;
}

.patient-card:hover{
  transform:translateY(-2px);
  box-shadow:0 10px 26px rgba(0,0,0,0.12);
}

/* ===============================
   AVATAR
================================ */
.avatar{
  width:44px;
  height:44px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:700;
  color:white;
  font-size:15px;
  flex-shrink:0;
}

/* ===============================
   INFOS PATIENT
================================ */
.patient-card .info{
  flex:1;
}

.patient-card .name{
  font-weight:700;
  font-size:15px;
  margin-bottom:4px;
}

.patient-card .meta{
  display:flex;
  gap:10px;
  font-size:13px;
  color:#6b7280;
  flex-wrap:wrap;
}

/* ===============================
   BADGES GRAVIT√â
================================ */
.badge{
  padding:2px 8px;
  border-radius:999px;
  font-size:12px;
  font-weight:700;
  background:#eef4ff;
  color:#1e40af;
}

/* Couleurs gravit√© */
.g-Urgences_Vitales,
.g-Urgences_Vitales .avatar{ background:#b91c1c; }

.g-P3,
.g-P3 .avatar{ background:#dc2626; }

.g-P2,
.g-P2 .avatar{ background:#f97316; }

.g-P1,
.g-P1 .avatar{ background:#eab308; color:#000; }

.g-P0,
.g-P0 .avatar{ background:#16a34a; }

.g-Administratif,
.g-Administratif .avatar{ background:#6b7280; }

/* ===============================
   COLONNE DROITE
================================ */
.actions{
  display:flex;
  gap:6px;
}

.allergy-star{
  font-size:18px;
  margin-bottom:6px;
}

/* ===============================
   PILLS (examens / actes / meds)
================================ */
.pill{
  display:inline-block;
  padding:6px 12px;
  border-radius:999px;
  font-size:13px;
  font-weight:600;
  margin:4px 6px 4px 0;
  white-space:nowrap;
  transition:0.15s;
}

.pill:hover{
  transform:scale(1.05);
}

/* ===============================
   MODALES ‚Äì STRUCTURE
================================ */
.modal{
  background:#fff;
  border-radius:20px;
  padding:22px;
  max-height:85vh;
  overflow-y:auto;
}

/* Titres de sections */
.section-title{
  margin-top:18px;
  margin-bottom:8px;
  font-size:14px;
  font-weight:800;
  text-transform:uppercase;
  color:#1e3a8a;
  letter-spacing:0.03em;
}

/* Champs */
.field{
  display:flex;
  justify-content:space-between;
  gap:12px;
  padding:6px 0;
  font-size:14px;
  border-bottom:1px dashed #e5e7eb;
}

.field:last-child{
  border-bottom:none;
}

.field label{
  font-weight:600;
  color:#374151;
  min-width:120px;
}

.field .val{
  flex:1;
  color:#111827;
  text-align:left;
  white-space:pre-line;
}

/* ===============================
   MODALES ‚Äì BOUTONS
================================ */
.modal button.btn{
  width:100%;
}

/* ===============================
   SEARCH RESULTS
================================ */
.res-item{
  padding:10px 14px;
  border-bottom:1px solid #eee;
  cursor:pointer;
}

.res-item:hover{
  background:#f0f7ff;
}

/* ===============================
   LISTE PRINCIPALE
================================ */
.list{
  margin-top:12px;
}
/* =====================================================
   1Ô∏è‚É£ COULEURS PATIENTS ‚Äî VERSION DOUCE / M√âDICALE
===================================================== */
.g-Urgences_Vitales,
.g-Urgences_Vitales .avatar{
  background:#fceaea;
  color:#7a1c1c;
}

.g-P3,
.g-P3 .avatar{
  background:#fdeeee;
  color:#8b1d1d;
}

.g-P2,
.g-P2 .avatar{
  background:#fff4e5;
  color:#8a4b12;
}

.g-P1,
.g-P1 .avatar{
  background:#fffbe6;
  color:#7a6a10;
}

.g-P0,
.g-P0 .avatar{
  background:#eefaf1;
  color:#1f6b3a;
}

.g-Administratif,
.g-Administratif .avatar{
  background:#f3f4f6;
  color:#374151;
}

/* Badge gravit√© plus discret */
.badge{
  background:#f1f5f9;
  color:#334155;
}

/* =====================================================
   2Ô∏è‚É£ MODALE PATIENT ‚Äî PLEIN √âCRAN MOBILE
===================================================== */
#modal.modal-overlay{
  align-items:stretch;
}

#modal .modal{
  width:100%;
  height:100%;
  max-width:none;
  max-height:none;
  border-radius:0;
  padding:18px 16px;
  animation:none;
}

/* Header collant */
#modal .modal > div:first-child{
  position:sticky;
  top:0;
  background:white;
  z-index:1;
  padding-bottom:10px;
  margin-bottom:10px;
  border-bottom:1px solid #e5e7eb;
}

/* Scroll confortable */
#modal .modal{
  overflow-y:auto;
}

/* =====================================================
   3Ô∏è‚É£ Z-INDEX PROPRE (ORDRE CLAIR)
===================================================== */
/* Fond patient */
#modal.modal-overlay{
  z-index:5000;
}

/* Examens / actes / meds AU-DESSUS */
#examModal.modal-overlay,
#acteModal.modal-overlay,
#medModal.modal-overlay{
  z-index:9999;
}

/* Sidebar toujours en dessous */
.sidebar{
  z-index:3000;
}
.sidebar-overlay{
  z-index:2500;
}

/* =====================================================
   4Ô∏è‚É£ MODALES SECONDAIRES ‚Äî FORMAT "FEUILLE"
===================================================== */
#examModal .modal,
#acteModal .modal,
#medModal .modal{
  width:92%;
  max-width:420px;
  border-radius:18px;
  padding:20px;
  animation:pop 0.25s ease-out;
  z-index:9999;
}

/* =====================================================
   5Ô∏è‚É£ PILLS PLUS DOUCES VISUELLEMENT
===================================================== */
.pill{
  background:#f1f5f9;
  color:#334155;
  border:1px solid #e2e8f0;
}

.pill:hover{
  background:#e8f0ff;
}

/* ===============================
   ACCUEIL ‚Äì LOGO (GAUCHE)
================================ */
#accueil-logo{
  display:block !important;
  max-width:120px !important;   /* limite dure */
  width:auto !important;
  height:auto !important;
  margin:0 0 16px 0 !important; /* PLUS de centrage */
  object-fit:contain;
}

/* S√©curit√© √©cran */
#accueil-logo{
  max-inline-size:120px;
}

/* Parent : alignement √† gauche */
#accueil-logo-parent{
  width:100%;
  max-width:100%;
  overflow:hidden;
  display:flex;
  justify-content:flex-start;
}



</style>
</head>
<body>
<div class="app" role="application" aria-label="Vue mobile urgences">

  <header>
  <button id="menuBtn" class="menu-btn">‚ò∞</button>
  <div style="flex:1">
    <h1>üöë GestUrg2 mobil</h1>
  </div>
</header>
<!-- MENU LAT√âRAL -->
<div id="sidebar" class="sidebar">
  <div class="sidebar-header">Menu</div>

  <div class="sidebar-item" onclick="goHome()">üè† Accueil</div>
  <div class="sidebar-item" onclick="goUrgences()">üöë Urgences</div>
  <div class="sidebar-item logout" onclick="logout()">üîì Se d√©connecter</div>
</div>

<div id="sidebarOverlay" class="sidebar-overlay"></div>
<div id="pageAccueil" class="page">
  <div class="accueil-wrap">
<div id="accueil-logo-parent">
  <img id="accueil-logo" src="logo.png" alt="Logo">
</div>
    <h2 id="accueilBienvenue">Bienvenue</h2>
    <div id="accueilHeure" class="accueil-heure">--:--</div>
    <p class="accueil-txt">S√©lectionnez une option dans le menu pour commencer.</p>
  </div>
</div>

<div id="pageUrgences" class="page" style="display:none">
  <div class="top-row">

    <div class="search-wrap">
      <input id="searchInput" class="search" type="search" placeholder="Rechercher nom / pr√©nom / ID..." aria-label="Rechercher patient"/>
      <div id="results" style="display:none" role="listbox" aria-label="R√©sultats de recherche"></div>
    
    
      <button id="refreshBtn" class="btn" title="Rafra√Æchir">üîÑ</button>
  
  </div>
</div>

  <div id="list" class="list" aria-live="polite"></div>

  <!-- Modal lecture seule -->
  <div id="modal" class="modal-overlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" role="document">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3 id="modalTitle">Fiche patient</h3>
        <button id="closeModal" style="background:transparent;border:0;font-size:20px;cursor:pointer">‚úñÔ∏è</button>
      </div>

      <div id="modalContent">
        <div class="section-title">Identit√©</div>
        <div class="field"><label>ID</label><div class="val" id="m-id">‚Äî</div></div>
        <div class="field"><label>Nom / Pr√©nom</label><div class="val" id="m-name">‚Äî</div></div>
        <div class="field"><label>Sexe ‚Ä¢ √Çge</label><div class="val" id="m-sexe-age">‚Äî</div></div>
        <div class="field"><label>Allergies</label><div class="val" id="m-allergies">‚Äî</div></div>

        <div class="section-title">Admission</div>
        <div class="field"><label>Gravit√©</label><div class="val" id="m-grav">‚Äî</div></div>
        <div class="field"><label>Motif</label><div class="val" id="m-motif">‚Äî</div></div>
        <div class="field"><label>Moyen</label><div class="val" id="m-moyen">‚Äî</div></div>
        <div class="field"><label>Position</label><div class="val" id="m-pos">‚Äî</div></div>
                <div class="field"><label>Statut PEC</label><div class="val" id="m-statut">‚Äî</div></div>


        <div class="section-title">Dossier m√©dical</div>
        <div class="field"><label>Questionnaire</label><div class="val" id="m-questionnaire">‚Äî</div></div>
        <div class="field"><label>Ant√©c√©dents</label><div class="val" id="m-antecedents">‚Äî</div></div>
        <div class="field"><label>Traitements</label><div class="val" id="m-traitements">‚Äî</div></div>
        <div class="field"><label>Histoire</label><div class="val" id="m-histoire">‚Äî</div></div>
        <div class="field"><label>Auscultation</label><div class="val" id="m-auscultation">‚Äî</div></div>

        <div class="section-title">Constantes</div>
<div class="field"><div class="val" id="m-constantes">‚Äî</div></div>

<div class="section-title">M√©dicaments aux urgences</div>
<div class="field"><div id="m-medicaments" class="val">Chargement...</div></div>

        <div class="section-title">Examens</div>
        <div class="field"><div class="val" id="m-exams">‚Äî</div></div>

        <div class="section-title">Actes</div>
        <div class="field"><div class="val" id="m-actes">‚Äî</div></div>

        <div style="margin-top:12px;display:flex;gap:8px;">
        </div>
        <br><br>
      </div>
    </div>
  </div>
<!-- MODALE MEDICAMENT -->
<div id="medModal" class="modal-overlay" style="display:none">
  <div class="modal">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3 id="med-title">M√©dicament</h3>
      <button id="medClose" style="background:none;border:0;font-size:20px;cursor:pointer">‚úñÔ∏è</button>
    </div>

    <div class="section-title">Informations</div>
    <div class="field"><label>Nom</label><div class="val" id="med-nom">‚Äî</div></div>
    <div class="field"><label>Date demande</label><div class="val" id="med-ddm">‚Äî</div></div>
    <div class="field"><label>Damand√© pour</label><div class="val" id="med-pr">‚Äî</div></div>
        <div class="field"><label>Date administration</label><div class="val" id="med-date-admin">‚Äî</div></div>

    <div class="field"><label>Commentaires demande</label><div class="val" id="med-commentsd">‚Äî</div></div>
   <div class="field"><label>Commentaires administration</label><div class="val" id="med-commentsp">‚Äî</div></div>
    <button id="medClose2" class="btn" style="margin-top:10px">Fermer</button>
  </div>
</div>


<!-- MODALE EXAMEN -->
<div id="examModal" class="modal-overlay" style="display:none">
  <div class="modal">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3 id="exam-title">Examen</h3>
      <button id="examClose" style="background:transparent;border:0;font-size:20px;cursor:pointer">‚úñÔ∏è</button>
    </div>

    <div class="section-title">Informations</div>
    <div class="field"><label>Type</label><div class="val" id="exam-type">‚Äî</div></div>
    <div class="field"><label>Date demande</label><div class="val" id="exam-date-demande">‚Äî</div></div>
    <div class="field"><label>Date r√©alisation</label><div class="val" id="exam-date-real">‚Äî</div></div>
    <div class="field"><label>Commentaires</label><div class="val" id="exam-comments">‚Äî</div></div>

    <div class="section-title">Compte-rendu</div>
    <div class="field"><div class="val" id="exam-report">‚Äî</div></div>

    <div class="section-title">Fichier</div>
    <div class="field"><div class="val" id="exam-file">Aucun fichier</div></div>

    <button id="examClose2" class="btn" style="margin-top:14px">Fermer</button>
  </div>
</div>
<!-- MODALE ACTE -->
<div id="acteModal" class="modal-overlay" style="display:none">
  <div class="modal">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3 id="acte-title">Acte</h3>
      <button id="acteClose" style="background:transparent;border:0;font-size:20px;cursor:pointer">‚úñÔ∏è</button>
    </div>

    <div class="section-title">Informations</div>
    <div class="field"><label>Type</label><div class="val" id="acte-type">‚Äî</div></div>
    <div class="field"><label>Date de demande</label><div class="val" id="acte-date-demande">‚Äî</div></div>
    <div class="field"><label>Commentaires</label><div class="val" id="acte-comments">‚Äî</div></div>

    <button id="acteClose2" class="btn" style="margin-top:14px">Fermer</button>
  </div>
</div>

</div>
</div>

<!-- Firebase compat (comme dans tes fichiers existants) -->
<script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>

<script>
/* ----------------------
   Config Firebase (identique √† tes fichiers)
   ---------------------- */
const firebaseConfig = {
  apiKey: "AIzaSyBKp5-7NNy0Gyl0tNbDgD-BxucYdg8ArWo",
  authDomain: "urgences-a8ed4.firebaseapp.com",
  projectId: "urgences-a8ed4",
  storageBucket: "urgences-a8ed4.firebasestorage.app",
  messagingSenderId: "392921498200",
  appId: "1:392921498200:web:7ccce767332c67c697c02d",
  measurementId: "G-C74MK2KYDL"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ----------------------
   Utils
   ---------------------- */
const sansAccents = s => s ? s.normalize('NFD').replace(/[\u0300-\u036f]/g, '').toLowerCase() : '';
const ageFromDOB = dob => {
  if(!dob) return '‚Äî';
  const d = new Date(dob);
  const diff = Date.now() - d.getTime();
  const y = Math.floor(diff / (1000*60*60*24*365.25));
  return y + ' ans';
};
const graviteClass = (g) => g ? 'g-' + String(g).replace(/\s+/g,'_') : 'g-Administratif';
const graviteLabel = (g) => g ? String(g).replace(/_/g,' ') : '‚Äî';

/* ----------------------
   DOM refs
   ---------------------- */
const listEl = document.getElementById('list');
const searchInput = document.getElementById('searchInput');
const resultsBox = document.getElementById('results');
const refreshBtn = document.getElementById('refreshBtn');

const modalOverlay = document.getElementById('modal');
const closeModal = document.getElementById('closeModal');

const m_id = document.getElementById('m-id');
const m_name = document.getElementById('m-name');
const m_sexe_age = document.getElementById('m-sexe-age');
const m_allergies = document.getElementById('m-allergies');
const m_grav = document.getElementById('m-grav');
const m_motif = document.getElementById('m-motif');
const m_moyen = document.getElementById('m-moyen');
const m_pos = document.getElementById('m-pos');
const m_statut = document.getElementById('m-statut');
const m_questionnaire = document.getElementById('m-questionnaire');
const m_antecedents = document.getElementById('m-antecedents');
const m_traitements = document.getElementById('m-traitements');
const m_histoire = document.getElementById('m-histoire');
const m_auscultation = document.getElementById('m-auscultation');
const m_temp = document.getElementById('m-temp');
const m_fc = document.getElementById('m-fc');
const m_ta = document.getElementById('m-ta');
const m_sat = document.getElementById('m-sat');
const m_fr = document.getElementById('m-fr');
const m_exams = document.getElementById('m-exams');
const m_actes = document.getElementById('m-actes');
const medModal = document.getElementById("medModal");
const medClose = document.getElementById("medClose");
const medClose2 = document.getElementById("medClose2");

function showMedModal(){ medModal.style.display = "flex"; }
function hideMedModal(){ medModal.style.display = "none"; }

medClose.onclick = hideMedModal;
medClose2.onclick = hideMedModal;
medModal.onclick = e => { if (e.target === medModal) hideMedModal(); };

let patientsCache = [];
let lastOpenedId = null;

/* ----------------------
   R√©cup√®re et rend la liste (m√©thode loyale √† urgences.html)
   ---------------------- */
async function fetchPatients() {
  listEl.innerHTML = '<div style="padding:12px;color:var(--muted)">Chargement‚Ä¶</div>';
  try {
    const snap = await db.collection('patients').get();
    const arr = [];

    for (const doc of snap.docs) {
      const data = doc.data();

      // V√©rifie s'il y a une hospitalisation active
      const hospiId = data.hospitalisationActiveId;
      let hospi = null; // initialisation √† null

      if (hospiId) {
        const hospiSnap = await db.collection('hospitalisations').doc(hospiId).get();
        if (hospiSnap.exists) hospi = hospiSnap.data();
      }

      // Ne garder que les patients ayant une hospitalisation active
      if (hospi) {
        arr.push({
          id: doc.id,
          docData: data,
          hospi
        });
      }
    }

    // tri : urgences vitales, P3,P2,P1,P0, puis alpha
    const order = {'Urgences_Vitales':0,'P3':1,'P2':2,'P1':3,'P0':4,'Administratif':5};
    arr.sort((a, b) => {
      const oa = order[a.hospi?.gravite] ?? 6;
      const ob = order[b.hospi?.gravite] ?? 6;
      if (oa !== ob) return oa - ob;
      const na = (a.docData.nom || '').toLowerCase();
      const nb = (b.docData.nom || '').toLowerCase();
      return na.localeCompare(nb);
    });

    patientsCache = arr;
    renderList(arr);

  } catch(e) {
    console.error(e);
    listEl.innerHTML = '<div style="padding:12px;color:#d9534f">Erreur chargement patients.</div>';
  }
}


function renderList(arr){
  listEl.innerHTML = '';
  if(arr.length === 0){
    listEl.innerHTML = '<div style="padding:12px;color:var(--muted)">Aucun patient hospitalis√©.</div>';
    return;
  }

  arr.forEach(p => {
    const card = document.createElement('div');
    const gravite = p.hospi?.gravite || 'P0';
    card.className = 'patient-card ' + graviteClass(gravite);
    card.dataset.id = p.id;

    const initials = document.createElement('div');
    initials.className = 'avatar ' + graviteClass(gravite);
    const nom = (p.docData.nom || '?').toString();
    const prenom = (p.docData.prenom || '').toString();
    initials.textContent = ( (nom[0]||'?') + (prenom[0]||'?') ).toUpperCase();

    const info = document.createElement('div');
    info.className = 'info';
    const name = document.createElement('div');
    name.className = 'name';
    name.textContent = `${(nom || '‚Äî').toUpperCase()} ${(prenom || '')}`;

    const meta = document.createElement('div');
    meta.className = 'meta';
    const age = document.createElement('div'); age.textContent = ageFromDOB(p.docData.dateNaissance);
    const place = document.createElement('div'); place.textContent = p.docData.position || '‚Äî';
    const grav = document.createElement('div'); grav.className = 'badge'; grav.textContent = graviteLabel(gravite);

    meta.appendChild(age);
    meta.appendChild(place);
    meta.appendChild(grav);

    info.appendChild(name);
    info.appendChild(meta);

    const rightCol = document.createElement('div');
    rightCol.style.display='flex';
    rightCol.style.flexDirection='column';
    rightCol.style.alignItems='flex-end';

    // allergy star (use importanceAllergies OR allergies text)
    if(p.docData.importanceAllergies === true || (p.docData.allergies && p.docData.allergies.trim() && p.docData.allergies.trim().toLowerCase() !== 'aucun')){
      const star = document.createElement('div');
      star.className = 'allergy-star';
      star.title = 'Allergie signal√©e';
      star.textContent = '‚≠ê';
      rightCol.appendChild(star);
    }

    const actions = document.createElement('div'); actions.className='actions';
    const btnView = document.createElement('button'); btnView.className='action-btn'; btnView.textContent='üîé';
    btnView.addEventListener('click', (e)=>{ e.stopPropagation(); openModalFor(p.id); });
   
    actions.appendChild(btnView); 
    rightCol.appendChild(actions);

    // double-click / touch long to open modal
    card.addEventListener('dblclick', ()=> openModalFor(p.id));
    let touchTimer = null;
    card.addEventListener('touchstart', e=>{
      touchTimer = setTimeout(()=> openModalFor(p.id),700);
    });
    card.addEventListener('touchend', e=>{ if(touchTimer) clearTimeout(touchTimer); });

    card.appendChild(initials);
    card.appendChild(info);
    card.appendChild(rightCol);
    listEl.appendChild(card);
  });
}

/* ----------------------
   Recherche autocomplete (local cache)
   ---------------------- */
searchInput.addEventListener('input', (e)=>{
  const q = sansAccents(e.target.value.trim());
  resultsBox.innerHTML=''; resultsBox.style.display='none';
  if(q.length < 2) return;
  const found = patientsCache.filter(p => {
    const nom = sansAccents(p.docData.nom || '');
    const pren = sansAccents(p.docData.prenom || '');
    return nom.includes(q) || pren.includes(q) || p.id.toLowerCase().includes(q);
  }).slice(0,30);

  if(found.length === 0){
    resultsBox.style.display='block';
    resultsBox.innerHTML = '<div class="res-item">Aucun r√©sultat</div>';
    return;
  }

  found.forEach(p=>{
    const d = document.createElement('div');
    d.className='res-item';
    d.textContent = `${p.docData.nom || ''} ${p.docData.prenom || ''} ‚Ä¢ ${p.hospi?.gravite || '‚Äî'} ‚Ä¢ ${p.docData.position||'‚Äî'}`;
    d.addEventListener('click', ()=> openModalFor(p.id));
    d.addEventListener('dblclick', ()=> window.location.href = `fiche.html?id=${p.id}`);
    resultsBox.appendChild(d);
  });
  resultsBox.style.display='block';
});

// hide results on click outside
document.addEventListener('click',(e)=>{
  if(!document.querySelector('.search-wrap').contains(e.target)){
    resultsBox.style.display='none';
  }
});

/* ----------------------
   Modal functions (loads patient document and fills modal using hospitalisationIndex)
   ---------------------- */
function showModal(){ modalOverlay.style.display='flex'; modalOverlay.setAttribute('aria-hidden','false'); }
function hideModal(){ modalOverlay.style.display='none'; modalOverlay.setAttribute('aria-hidden','true'); }
closeModal.addEventListener('click', hideModal);

async function openModalFor(id) {
  lastOpenedId = id;
  try {
    const patientSnap = await db.collection('patients').doc(id).get();
    if (!patientSnap.exists) { alert('Patient introuvable'); return; }
    const data = patientSnap.data();

    const hospiId = data.hospitalisationActiveId;
    let hospi = {};
    if (hospiId) {
      const hospiSnap = await db.collection('hospitalisations').doc(hospiId).get();
      if (hospiSnap.exists) hospi = hospiSnap.data();
    }

    // identit√©
    m_id.textContent = id;
    m_name.textContent = `${data.nom || '‚Äî'} ${data.prenom || ''}`;
    m_sexe_age.textContent = `${data.sexe || '‚Äî'} ‚Ä¢ ${ageFromDOB(data.dateNaissance)}`;
    m_allergies.textContent = data.allergies || (data.importanceAllergies ? 'Allergies (importantes)' : 'Aucune');

    // admission
    m_grav.textContent = hospi.gravite || '‚Äî';
    m_motif.textContent = hospi.motif || '‚Äî';
    m_moyen.textContent = hospi.moyen || '‚Äî';
    m_pos.textContent = data.position || '‚Äî';
    m_statut.textContent = data.pdcStatut || '‚Äî';

    // dossier m√©dical
    const dm = hospi.dossierMedical || {};
    m_questionnaire.textContent = dm.questionnaire || '‚Äî';
    m_antecedents.textContent = dm.antecedents || '‚Äî';
    m_traitements.textContent = dm.traitements || '‚Äî';
    m_histoire.textContent = dm.histoire || '‚Äî';
    m_auscultation.textContent = dm.auscultation || '‚Äî';

    
    // ---------------------------
// Constantes regroup√©es
// ---------------------------
const c = hospi.constantes || {};
const constantesText = 
    `Temp : ${c.temperature || "‚Äî"}\n` +
    `FC : ${c.fc || "‚Äî"}\n` +
    `TA : ${c.ta || "‚Äî"}\n` +
    `SpO2 : ${c.saturation || "‚Äî"}\n` +
    `FR : ${c.fr || "‚Äî"}\n` +
    `Douleur : ${c.douleur || "‚Äî"}`;

document.getElementById("m-constantes").textContent = constantesText;

// ---------------------------
// EXAMENS ‚Äî couleur + clic = modale
// ---------------------------
const examsRaw = Array.isArray(hospi.examens)
  ? hospi.examens
  : (Array.isArray(hospi.examensDemandes) ? hospi.examensDemandes : []);

// Filtre des entr√©es vides
const exams = examsRaw.filter(e => {
  if (!e) return false;
  if (typeof e === "string" && e.trim() === "") return false;
  if (typeof e === "object" && Object.keys(e).length === 0) return false;
  return true;
});

if (exams.length === 0) {
  m_exams.textContent = "Aucun examen";
} else {
  m_exams.innerHTML = "";

  exams.forEach((ex, i) => {
    const pill = document.createElement("span");
    pill.className = "pill";
    pill.style.cursor = "pointer";
    pill.textContent = truncateText(ex.type || "Examen", 25);


    // ---------------------------
    // CODE COULEUR EXAMENS
    // ---------------------------
    const realised = !!ex.dateRealisation;

    if (realised) {
      // VERT = r√©alis√©
      pill.style.background = "#e8fff1";
      pill.style.color = "#146c2e";
      pill.style.border = "1px solid #cbf7d5";
    } else {
      // BLEU = non r√©alis√©
      pill.style.background = "#d7e9ff";
      pill.style.color = "#0d47a1";
      pill.style.border = "1px solid #c1d7ff";
    }

    pill.onclick = () => openExam(id, i);
    m_exams.appendChild(pill);
  });
}


// ---------------------------
// Actes
// ---------------------------
let rawActes = Array.isArray(hospi.actes) ? hospi.actes : [];

// Filtre les actes vides
const actes = rawActes.filter(a => {
  if (!a) return false;
  if (typeof a === "string" && a.trim() === "") return false;
  if (typeof a === "object" && Object.keys(a).length === 0) return false;
  return true;
});

if (actes.length) {
  m_actes.innerHTML = "";
  actes.forEach((a, i) => {
    const s = document.createElement("span");
    s.className = "pill";
    s.textContent = truncateText(a.type || a || "Acte", 25);


    // clique ‚Üí modale acte
    s.style.cursor = "pointer";
    s.onclick = () => openActe(id, i);

    m_actes.appendChild(s);
  });
} else {
  m_actes.textContent = "Aucun acte";
}
// ----------------------------------------------------
// M√âDICAMENTS AUX URGENCES ‚Äî VERSION CORRECTE POUR TA STRUCTURE
// ----------------------------------------------------
const medsDiv = document.getElementById("m-medicaments");
medsDiv.textContent = "Chargement...";

// hospitalisation actuelle
const hospiIndex = data.hospitalisationIndex ?? 0;
const hospi2 = data.hospitalisations?.[hospiIndex] || {};
const meds = hospi2.meds || [];

if (!Array.isArray(meds) || meds.length === 0) {
    medsDiv.textContent = "Aucun m√©dicament";
} 
else {
    medsDiv.innerHTML = "";

    meds.forEach((m, i) => {
      console.log("---- med index", i, "----");
console.log("m:", m);
console.log("m.status initial:", m.status);
console.log("m.dueAt raw:", m.dueAt);

        // m = le DOCUMENT du m√©dicament (directement)
        const pill = document.createElement("span");
        pill.className = "pill";
        pill.style.cursor = "pointer";

pill.textContent = truncateText(m.product || "M√©dicament", 25);

        // -----------------------------
        // LOGIQUE CODE COULEUR EXACTE
        // -----------------------------
        let status = m.status || "";

      if (status !== "pris") {
    const now = new Date();
    const due = m.dueAt?.toDate?.() ? m.dueAt.toDate() : null;

    if (due) {
        const diff = (now - due) / 60000;

        if (diff >= -10 && diff <= 10) {
            status = "a-donner";           // Dans la fen√™tre ¬±10 min
        } else if (diff < -10) {
            status = "prevu";              // Plus de 10 min avant
        } else if (diff > 10) {
            status = "en-retard";          // Plus de 10 min apr√®s
        }
    }
}


        if (status === "pris") {
            pill.style.background = "#e8fff1";
            pill.style.color = "#146c2e";
            pill.style.border = "1px solid #cbf7d5";
        }
        else if (status === "en-retard") {
            pill.style.background = "#ffecec";
            pill.style.color = "#c62828";
            pill.style.border = "1px solid #ffdada";
        }
        else if (status === "a-donner") {
            pill.style.background = "#d7e9ff";
            pill.style.color = "#0d47a1";
            pill.style.border = "1px solid #c1d7ff";
        }
        else if (status === "prevu") {
            pill.style.background = "#eef4ff";
            pill.style.color = "#0d47a1";
            pill.style.border = "1px solid #d0e0ff";
        }

        // clic ‚Üí ouvrir modale d√©taill√©e
        pill.onclick = () => openMedicamentLocal(m);

        medsDiv.appendChild(pill);
    });
}



    showModal();
  }catch(err){
    console.error(err);
    alert('Erreur r√©cup√©ration fiche');
  }
}
/* ------------------------------------------------
   MODALE EXAMEN
---------------------------------------------------*/
const examModal = document.getElementById('examModal');
const examClose = document.getElementById('examClose');
const examClose2 = document.getElementById('examClose2');

function showExamModal(){ examModal.style.display='flex'; }
function hideExamModal(){ examModal.style.display='none'; }

examClose.onclick = hideExamModal;
examClose2.onclick = hideExamModal;
examModal.onclick = (e)=>{ if(e.target === examModal) hideExamModal(); };

/* Charge un examen complet dans la modale */
async function openExam(patientId, examIndex) {
  try {
    // üîπ Charger le patient
    const patientSnap = await db.collection("patients").doc(patientId).get();
    if (!patientSnap.exists) return alert("Patient introuvable");
    const patientData = patientSnap.data();

    // üîπ Charger l'hospitalisation active
    const hospiId = patientData.hospitalisationActiveId;
    if (!hospiId) return alert("Aucune hospitalisation active");

    const hospiSnap = await db.collection("hospitalisations").doc(hospiId).get();
    if (!hospiSnap.exists) return alert("Hospitalisation introuvable");
    const hospi = hospiSnap.data();

    // üîπ R√©cup√©rer examens
    const exams = hospi.examens || hospi.examensDemandes || [];
    const ex = exams[examIndex];
    if (!ex) return alert("Examen introuvable");

    // üîπ Remplissage modal
    document.getElementById("exam-title").textContent = ex.type || "Examen";
    document.getElementById("exam-type").textContent = ex.type || "‚Äî";
    document.getElementById("exam-date-demande").textContent = ex.dateDemande || "‚Äî";
    document.getElementById("exam-date-real").textContent = ex.dateRealisation || "‚Äî";
    document.getElementById("exam-comments").textContent = ex.commentaires || ex.commentaire || "‚Äî";
    document.getElementById("exam-report").textContent = ex.compteRendu || "‚Äî";

    const fileDiv = document.getElementById("exam-file");
    if (ex.fichier) {
      fileDiv.innerHTML = `<a href="${ex.fichier}" target="_blank">Voir fichier</a>`;
    } else {
      fileDiv.textContent = "Aucun fichier";
    }

    showExamModal();

  } catch (e) {
    console.error(e);
    alert("Erreur chargement examen");
  }
}


/* ----------------------
   Refresh / init
   ---------------------- */
refreshBtn.addEventListener('click', fetchPatients);
window.addEventListener('load', fetchPatients);

// close modal by clicking overlay
modalOverlay.addEventListener('click', (e)=>{ if(e.target === modalOverlay) hideModal(); });

/* ------------------------------------------------
   MODALE ACTE
---------------------------------------------------*/
const acteModal = document.getElementById('acteModal');
const acteClose = document.getElementById('acteClose');
const acteClose2 = document.getElementById('acteClose2');

function showActeModal(){ acteModal.style.display='flex'; }
function hideActeModal(){ acteModal.style.display='none'; }

acteClose.onclick = hideActeModal;
acteClose2.onclick = hideActeModal;
acteModal.onclick = (e)=>{ if(e.target === acteModal) hideActeModal(); };

/* Charger un acte dans la modale */
async function openActe(patientId, acteIndex) {
  try {
    // üîπ Charger le patient
    const patientSnap = await db.collection("patients").doc(patientId).get();
    if (!patientSnap.exists) return alert("Patient introuvable");
    const patientData = patientSnap.data();

    // üîπ Charger l'hospitalisation active
    const hospiId = patientData.hospitalisationActiveId;
    if (!hospiId) return alert("Aucune hospitalisation active");

    const hospiSnap = await db.collection("hospitalisations").doc(hospiId).get();
    if (!hospiSnap.exists) return alert("Hospitalisation introuvable");
    const hospi = hospiSnap.data();

    // üîπ R√©cup√©rer actes
    const actes = Array.isArray(hospi.actes) ? hospi.actes : [];
    const a = actes[acteIndex];
    if (!a) return alert("Acte introuvable");

    // üîπ Remplissage modal
    document.getElementById("acte-title").textContent = a.type || "Acte";
    document.getElementById("acte-type").textContent = a.type || "‚Äî";
    document.getElementById("acte-date-demande").textContent = a.date || "‚Äî";
    document.getElementById("acte-comments").textContent = a.commentaires || "‚Äî";

    showActeModal();

  } catch(e){
    console.error(e);
    alert("Erreur chargement acte");
  }
}

async function openMedicament(patientId, medIndex) {
  try {
    // üîπ Charger le patient
    const patientSnap = await db.collection("patients").doc(patientId).get();
    if (!patientSnap.exists) return alert("Patient introuvable");
    const patientData = patientSnap.data();

    // üîπ R√©cup√©rer l'hospitalisation active
    const hospiId = patientData.hospitalisationActiveId;
    if (!hospiId) return alert("Aucune hospitalisation active");

    const hospiSnap = await db.collection("hospitalisations").doc(hospiId).get();
    if (!hospiSnap.exists) return alert("Hospitalisation introuvable");
    const hospi = hospiSnap.data();

    // üîπ R√©cup√©rer le m√©dicament
    const meds = Array.isArray(hospi.meds) ? hospi.meds : [];
    const m = meds[medIndex];
    if (!m) return alert("M√©dicament introuvable");

    // üîπ Remplissage modal
    document.getElementById("med-title").textContent = m.product || "M√©dicament";
    document.getElementById("med-nom").textContent = m.product || "‚Äî";
    document.getElementById("med-ddm").textContent = m.createdAt || "‚Äî";
    document.getElementById("med-pr").textContent = m.dueAt || "‚Äî";
    document.getElementById("med-date-admin").textContent = m.takenAt || "‚Äî";
    document.getElementById("med-commentsd").textContent = m.comment || "‚Äî";
    document.getElementById("med-commentsp").textContent = m.takeComment || "‚Äî";

    showMedModal();

  } catch (err) {
    console.error(err);
    alert("Erreur chargement m√©dicament");
  }
}

// Si tu as d√©j√† l'objet m√©dicament localement
function openMedicamentLocal(m) {
  document.getElementById("med-title").textContent = m.product || "M√©dicament";
  document.getElementById("med-nom").textContent = m.product || "‚Äî";
  document.getElementById("med-ddm").textContent = m.createdAt || "‚Äî";
  document.getElementById("med-pr").textContent = m.dueAt || "‚Äî";
  document.getElementById("med-date-admin").textContent = m.takenAt || "‚Äî";
  document.getElementById("med-commentsd").textContent = m.comment || "‚Äî";
  document.getElementById("med-commentsp").textContent = m.takeComment || "‚Äî";

  showMedModal();
}

function truncateText(text, maxLength = 30) {
  if (!text) return "";
  return text.length > maxLength ? text.slice(0, maxLength) + "‚Ä¶" : text;
}

</script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
  import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBKp5-7NNy0Gyl0tNbDgD-BxucYdg8ArWo",
    authDomain: "urgences-a8ed4.firebaseapp.com",
    projectId: "urgences-a8ed4"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

let medecinNom = "";
  let medecinSpecialite = "";
  let medecinLieu = "";

  onAuthStateChanged(auth, async (user) => {
  if (!user) {
    window.location.href = "index.html";
  } else {
    try {
      const docRef = doc(db, "medecins", user.uid);
      const docSnap = await getDoc(docRef);
      if (docSnap.exists()) {
        const data = docSnap.data();
  window.medecinNom = data.nom || "";
        window.medecinSpecialite = data.specialite || "";
        window.medecinLieu = data.lieu || "";



        // --- V√©rification d'acc√®s √† la page ---
        const pages = data.pages || {};
        const currentPath = window.location.pathname;
        const currentPage = "fichemobile";

        if (!pages[currentPage]) {
          alert("‚õîÔ∏è Vous n‚Äôavez pas acc√®s √† cette page.");
          window.location.href = "index.html";
          return; // Stoppe le script ici
        }
      } else {
        // Document inexistant ‚Äî redirection
        alert("Utilisateur non trouv√©, veuillez vous reconnecter.");
        window.location.href = "index.html";
      }
    } catch (error) {
      console.error("Erreur chargement m√©decin :", error);
      alert("Une erreur est survenue, veuillez r√©essayer plus tard.");
    }
  }
});
</script>
<script>
const sb = document.getElementById("sidebar");
const sbOverlay = document.getElementById("sidebarOverlay");
const menuBtn = document.getElementById("menuBtn");

// Pages internes
const pageAccueil = document.getElementById("pageAccueil");
const pageUrgences = document.getElementById("pageUrgences");

// --- OUVERTURE / FERMETURE MENU ---
menuBtn.onclick = () => {
  sb.classList.add("open");
  sbOverlay.classList.add("show");
};
sbOverlay.onclick = () => {
  sb.classList.remove("open");
  sbOverlay.classList.remove("show");
};

// --- CHARGEMENT PAR D√âFAUT : ACCUEIL ---
window.addEventListener("load", () => {
  ouvrirAccueil();
  startHorloge();
});

// --- FONCTIONS POUR CHANGER DE "PAGE" ---
function ouvrirAccueil(){
  pageUrgences.style.display = "none";
  pageAccueil.style.display = "block";
  sb.classList.remove("open");
  sbOverlay.classList.remove("show");
}

function ouvrirUrgences(){
  pageAccueil.style.display = "none";
  pageUrgences.style.display = "block";
  sb.classList.remove("open");
  sbOverlay.classList.remove("show");
}

// --- MENUS ---
function goHome(){ ouvrirAccueil(); }
function goUrgences(){ ouvrirUrgences(); }

// --- HORLOGE ---
function startHorloge(){
  const el = document.getElementById("accueilHeure");
  setInterval(() => {
    const d = new Date();
    el.textContent = d.toLocaleTimeString("fr-FR", {hour: "2-digit", minute:"2-digit"});
  }, 1000);
}

// --- MESSAGE DE BIENVENUE EN FONCTION DU MEDECIN CONNECT√â ---
if (window.medecinNom){
  document.getElementById("accueilBienvenue").textContent =
    "Bienvenue Dr " + window.medecinNom;
}

// --- LOGOUT ---
function logout(){
  if (confirm("Voulez-vous vous d√©connecter ?")) {
    import("https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js").then(module => {
      const { getAuth, signOut } = module;
      const auth = getAuth();

      signOut(auth).then(() => {
        window.location.href = "index.html";
      }).catch(err => {
        alert("Erreur lors de la d√©connexion : " + err.message);
      });
    });
  }
}

</script>

</body>
</html>
