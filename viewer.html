<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Document PDF</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Firebase (AUTONOME) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    overflow: hidden;
    font-family: Arial, sans-serif;
}

header {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 8px 16px;
    background: #1e293b;
    color: white;
}

header img {
    height: 36px;
}

header span {
    font-size: 16px;
    font-weight: bold;
}

#pdfWrapper {
    height: 100% ;
}

iframe {
    width: 100%;
    height: 100%;
    border: none;
}
</style>
</head>
<body>



<div id="pdfWrapper">
    <iframe id="pdfFrame"></iframe>
</div>

<script>
/* ===============================
   üî• CONFIG FIREBASE (√Ä REMPLACER)
   =============================== */
const firebaseConfig = {
    apiKey: "AIzaSyBKp5-7NNy0Gyl0tNbDgD-BxucYdg8ArWo",
    authDomain: "urgences-a8ed4.firebaseapp.com",
    projectId: "urgences-a8ed4",
    storageBucket: "urgences-a8ed4.appspot.com",
    messagingSenderId: "392921498200",
    appId: "1:392921498200:web:7ccce767332c67c697c02d",
    measurementId: "G-C74MK2KYDL"
}; 	

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ===============================
   üìÑ R√âCUP√âRATION docId
   =============================== */
const params = new URLSearchParams(window.location.search);
const docId = params.get("docId");

if (!docId) {
    document.body.innerHTML = "<h2 style='padding:20px'>Document manquant</h2>";
    throw new Error("docId manquant");
}

/* ===============================
   üîÅ BASE64 ‚Üí BLOB
   =============================== */
function b64toBlob(b64, type) {
    const bytes = atob(b64);
    const arr = new Uint8Array(bytes.length);
    for (let i = 0; i < bytes.length; i++) {
        arr[i] = bytes.charCodeAt(i);
    }
    return new Blob([arr], { type });
}

/* ===============================
   üì• CHARGEMENT DOCUMENT
   =============================== */
db.collection("documents").doc(docId).get().then(snap => {

    if (!snap.exists) {
        document.body.innerHTML = "<h2 style='padding:20px'>Document introuvable</h2>";
        return;
    }

    const data = snap.data();

    if (!data.pdfBase64) {
        document.body.innerHTML = "<h2 style='padding:20px'>PDF indisponible</h2>";
        return;
    }

    const blob = b64toBlob(data.pdfBase64, "application/pdf");
    const url = URL.createObjectURL(blob);

    // üëâ Visionneuse PDF NATIVE du navigateur
    document.getElementById("pdfFrame").src = url;
});
</script>

</body>
</html>
